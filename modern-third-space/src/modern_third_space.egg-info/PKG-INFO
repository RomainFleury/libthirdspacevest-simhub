Metadata-Version: 2.4
Name: modern-third-space
Version: 0.1.0
Summary: Modern Python bridge APIs for the Third Space Vest
Author-email: SimHub Contributors <contact@simhub.dev>
Requires-Python: >=3.11
Description-Content-Type: text/markdown
Requires-Dist: pyusb>=1.2.1
Provides-Extra: dev
Requires-Dist: ruff>=0.7.0; extra == "dev"
Requires-Dist: pytest>=7.4.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "dev"

# modern-third-space

`modern-third-space` is a lightweight Python package that wraps the original `thirdspace.py` driver while keeping the legacy sources untouched inside `legacy-do-not-change/`.

## Goals

- Provide a clean, typed API the Electron debugger app (and other tools) can call.
- Surface useful status information (USB availability, cache key state, last command).
- Offer a tiny CLI (`modern-third-space status`, `... trigger --cell 2 --speed 5`) for quick manual testing or scripting.

## Installation

### PyUSB Dependency

This package requires PyUSB for USB device communication. Install it with:

```bash
pip install pyusb
```

**Platform-specific notes:**

- **macOS**: PyUSB should work out of the box after `pip install pyusb`.
- **Linux**: You may need to install system libraries first:

  ```bash
  # Debian/Ubuntu
  sudo apt-get install libusb-1.0-0-dev
  
  # Fedora/RHEL
  sudo dnf install libusb1-devel
  
  # Then install PyUSB
  pip install pyusb
  ```

- **Windows**: PyUSB should work, but you may need to install [libusb-win32](http://libusb-win32.sourceforge.net/) or [Zadig](https://zadig.akeo.ie/) drivers for your USB device.

If PyUSB is not installed, the `list` command will return a fake device with serial number `"sorry-bro"` to indicate the missing dependency.

## Verifying Setup

After installing the package, you can verify your setup is working correctly:

**Option 1: Use the Node.js diagnostic script (recommended):**

From the `web/` directory:

```bash
cd ../web
yarn check:python
```

This will test both `ping` and `list` commands and provide helpful diagnostics.

**Option 2: Test manually:**

```bash
# Test ping command
python3 -m modern_third_space.cli ping
# Should output: {"status": "ok", "message": "Python bridge is reachable"}

# Test list command
python3 -m modern_third_space.cli list
# Should show connected devices, or a fake device with serial "sorry-bro" if PyUSB isn't installed
```

## Package Structure

```
modern_third_space/
â”œâ”€â”€ vest/                    # ğŸ”’ Core vest hardware (isolated)
â”‚   â”œâ”€â”€ controller.py        # VestController - connection + commands
â”‚   â”œâ”€â”€ status.py            # VestStatus dataclass
â”‚   â””â”€â”€ discovery.py         # list_devices() - USB scanning
â”œâ”€â”€ server/                  # ğŸŒ TCP Daemon
â”‚   â”œâ”€â”€ daemon.py            # Main daemon loop, command handlers
â”‚   â”œâ”€â”€ protocol.py          # JSON protocol (Command, Event, Response)
â”‚   â”œâ”€â”€ client_manager.py    # Track connected TCP clients
â”‚   â””â”€â”€ lifecycle.py         # Start/stop/status management
â”œâ”€â”€ integrations/            # ğŸ® Game integrations (daemon clients)
â”‚   â”œâ”€â”€ base.py              # DaemonConnection, BaseGameIntegration
â”‚   â””â”€â”€ cs2_gsi.py           # Counter-Strike 2 GSI integration
â”œâ”€â”€ presets.py               # UI effect presets (not hardware code)
â”œâ”€â”€ cli.py                   # CLI interface (daemon, cs2 subcommands)
â”œâ”€â”€ legacy_adapter.py        # Legacy driver loader
â””â”€â”€ legacy_port/             # Ported legacy driver
```

### Isolation Principle

The `vest/` package contains **only hardware interaction code**. It must remain isolated from:

- Game integrations and listeners
- External interfaces (WebSocket, HTTP, etc.)
- UI-specific code

The `server/` package provides a TCP daemon that imports from `vest/` and exposes commands to external clients.

Game integrations (in `integrations/`) connect to the daemon as TCP clients - they don't import `vest/` directly.

## CLI Commands

### Daemon Commands

```bash
python3 -m modern_third_space.cli daemon start      # Start on port 5050
python3 -m modern_third_space.cli daemon status     # Check status + health
python3 -m modern_third_space.cli daemon stop       # Stop the daemon
```

### CS2 Integration Commands

```bash
python3 -m modern_third_space.cli cs2 start           # Start CS2 GSI listener
python3 -m modern_third_space.cli cs2 status          # Check integration status
python3 -m modern_third_space.cli cs2 generate-config # Generate CS2 config file
```

### Direct CLI Commands (no daemon)

```bash
python3 -m modern_third_space.cli ping      # Health check
python3 -m modern_third_space.cli list      # List USB devices
python3 -m modern_third_space.cli status    # Connection status
```

## Development

```bash
cd modern-third-space
python -m venv .venv
source .venv/bin/activate
pip install -e .[dev]
pip install pyusb  # Don't forget PyUSB!
```

The package dynamically loads the legacy `ThirdSpaceVest` class via `importlib` and never modifies the historical files. Any enhancements should go through the wrapper or new modules here.

## Testing

See `TESTING.md` for comprehensive testing examples including:

- Daemon commands via netcat/Python
- Simulated CS2 payloads
- End-to-end integration tests
